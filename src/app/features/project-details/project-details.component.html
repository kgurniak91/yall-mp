@if (project(); as project) {
  <app-project-header [mediaFileName]="project.mediaFileName"
                      [subtitleFileName]="project.subtitleFileName"
                      (newProjectClicked)="onNewProjectClicked()"
                      (editProjectClicked)="onEditProjectClicked()"
                      (goToProjectsListClicked)="onGoToProjectsListClicked()"
                      (helpClicked)="onHelpClicked()"
                      (deleteProjectClicked)="onDeleteProjectClicked()"/>
}

<div class="video-area">
  <div class="video-wrapper">
    <app-video-controller [options]="options"/>
  </div>
</div>

<div class="subtitle-display">
  @if (clipsStateService.currentClip(); as currentClip) {
    @if (currentClip.hasSubtitle) {
      <span [class.blurred-subtitles]="!videoStateService.subtitlesVisible()">
        {{ currentClip.text }}
      </span>
    } @else {
      &nbsp;
    }
  } @else {
    &nbsp;
  }
</div>

<div class="toolbar">
  <div>
    <p-button (click)="opStart.toggle($event)"
              icon="fa-solid fa-arrows-down-to-line"
              class="rotate-90"
              tooltipPosition="left"
              severity="secondary"
              pTooltip="Adjust Clip Start"/>

    <p-popover #opStart>
      <div class="p-buttonset">
        <p-button (click)="adjustClipStartLeft()" icon="fa fa-chevron-left" severity="secondary" variant="outlined"
                  tooltipPosition="left" pTooltip="Adjust Left ([)"/>
        <p-button (click)="adjustClipStartRight()" icon="fa fa-chevron-right" severity="secondary" variant="outlined"
                  tooltipPosition="right" pTooltip="Adjust Right (Ctrl+[)"/>
      </div>
    </p-popover>
  </div>

  <p-button icon="fa-solid fa-arrow-left"
            pTooltip="Previous subtitled clip"
            tooltipPosition="left"
            severity="secondary"
            (onClick)="goToPreviousSubtitleClip()"/>

  <p-button icon="fa-solid {{clipsStateService.isPlaying() ? 'fa-pause' : 'fa-play'}}"
            [pTooltip]="clipsStateService.isPlaying() ? 'Pause' : 'Play'"
            tooltipPosition="top"
            severity="secondary"
            (onClick)="togglePlayPause()"/>

  <p-button icon="fa-solid fa-repeat"
            pTooltip="Repeat current clip"
            tooltipPosition="top"
            severity="secondary"
            (onClick)="repeatCurrentClip()"/>

  <p-button icon="fa-solid fa-arrow-right"
            pTooltip="Next subtitled clip"
            tooltipPosition="right"
            severity="secondary"
            (onClick)="goToNextSubtitleClip()"/>

  <div>
    <p-button (click)="opEnd.toggle($event)"
              icon="fa-solid fa-arrows-up-to-line"
              class="rotate-90"
              tooltipPosition="right"
              severity="secondary"
              pTooltip="Adjust Clip End"/>

    <p-popover #opEnd>
      <div class="p-buttonset">
        <p-button (click)="adjustClipEndLeft()" icon="fa fa-chevron-left" severity="secondary" variant="outlined"
                  tooltipPosition="left" pTooltip="Adjust Left (Ctrl+])"/>
        <p-button (click)="adjustClipEndRight()" icon="fa fa-chevron-right" severity="secondary" variant="outlined"
                  tooltipPosition="right" pTooltip="Adjust Right (])"/>
      </div>
    </p-popover>
  </div>

  <div class="settings-wrapper">
    @let subtitlesVisible = videoStateService.subtitlesVisible();
    <p-button icon="{{subtitlesVisible ? 'fa-solid' : 'fa-regular'}} fa-closed-captioning"
              [pTooltip]="subtitlesVisible ? 'Hide subtitles' : 'Show subtitles'"
              (onClick)="videoStateService.toggleSubtitlesVisible()"
              tooltipPosition="left"
              severity="secondary"/>

    <p-button icon="fa-solid fa-gear"
              pTooltip="Settings"
              tooltipPosition="left"
              severity="secondary"
              (onClick)="toggleSettings()"/>
  </div>
</div>

<app-timeline-editor/>

<p-drawer [(visible)]="isSettingsVisible"
          (onHide)="toggleSettings()"
          header="Settings"
          position="right"
          [style]="{width: '30rem'}">
  <app-project-settings/>
</p-drawer>
